{"version":3,"file":"main.min.js","mappings":"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","sources":["webpack://image-stylization-sines/./src/ts/helpers.ts","webpack://image-stylization-sines/./src/ts/input-image.ts","webpack://image-stylization-sines/./src/ts/interfaces/i-point.ts","webpack://image-stylization-sines/./src/ts/lines/lines-base.ts","webpack://image-stylization-sines/./src/ts/lines/lines-polygon.ts","webpack://image-stylization-sines/./src/ts/lines/lines-sines.ts","webpack://image-stylization-sines/./src/ts/lines/lines-spiral.ts","webpack://image-stylization-sines/./src/ts/lines/lines-straight-lines.ts","webpack://image-stylization-sines/./src/ts/main.ts","webpack://image-stylization-sines/./src/ts/parameters.ts","webpack://image-stylization-sines/./src/ts/pattern/pattern-base.ts","webpack://image-stylization-sines/./src/ts/pattern/pattern-dithering.ts","webpack://image-stylization-sines/./src/ts/pattern/pattern-wave.ts","webpack://image-stylization-sines/./src/ts/plotter/plotter-base.ts","webpack://image-stylization-sines/./src/ts/plotter/plotter-canvas-2d.ts","webpack://image-stylization-sines/./src/ts/plotter/plotter-svg.ts","webpack://image-stylization-sines/webpack/bootstrap","webpack://image-stylization-sines/webpack/startup"],"sourcesContent":["import { ISize } from \"./interfaces/i-size\";\r\nimport { Parameters, ELinesType, EPattern } from \"./parameters\";\r\nimport { LinesBase } from \"./lines/lines-base\";\r\nimport { LinesStraightLines } from \"./lines/lines-straight-lines\";\r\nimport { LinesSines } from \"./lines/lines-sines\";\r\nimport { LinesSpiral } from \"./lines/lines-spiral\";\r\nimport { IImageFitting } from \"./plotter/plotter-base\";\r\nimport { LinesPolygon } from \"./lines/lines-polygon\";\r\nimport { PatternWave } from \"./pattern/pattern-wave\";\r\nimport { PatternBase } from \"./pattern/pattern-base\";\r\nimport { PatternDithering } from \"./pattern/pattern-dithering\";\r\n\r\n\r\nfunction chooseLines(imageSizeInPlotter: ISize, linesSpacing: number): LinesBase {\r\n    const chosenType = Parameters.linesType;\r\n    if (chosenType === ELinesType.STRAIGHT) {\r\n        return new LinesStraightLines(imageSizeInPlotter, linesSpacing);\r\n    } else if (chosenType === ELinesType.SPIRAL) {\r\n        return new LinesSpiral(imageSizeInPlotter, linesSpacing);\r\n    } else if (chosenType === ELinesType.POLYGON) {\r\n        return new LinesPolygon(imageSizeInPlotter, linesSpacing);\r\n    } else {\r\n        return new LinesSines(imageSizeInPlotter, linesSpacing);\r\n    }\r\n}\r\n\r\nfunction choosePattern(imageFitting: IImageFitting, linesSpacing: number): PatternBase {\r\n    const pattern = Parameters.pattern;\r\n    if (pattern === EPattern.WAVES) {\r\n        return new PatternWave(imageFitting, linesSpacing);\r\n    } else {\r\n        return new PatternDithering(imageFitting, linesSpacing);\r\n    }\r\n}\r\n\r\nfunction downloadTextFile(content: string, filename: string): void {\r\n    const fileType = \"text/plain\";\r\n\r\n    const blob = new Blob([content], { type: fileType });\r\n\r\n    if (typeof window.navigator !== \"undefined\" && typeof (window.navigator as any).msSaveBlob !== \"undefined\") { // for IE\r\n        (window.navigator as any).msSaveBlob(blob, filename);\r\n    } else {\r\n        const objectUrl = URL.createObjectURL(blob);\r\n\r\n        const linkElement = document.createElement('a');\r\n        linkElement.download = filename;\r\n        linkElement.href = objectUrl;\r\n        linkElement.dataset.downloadurl = `${fileType}:${linkElement.download}:${linkElement.href}`;\r\n        linkElement.style.display = \"none\";\r\n        document.body.appendChild(linkElement);\r\n        linkElement.click();\r\n        document.body.removeChild(linkElement);\r\n\r\n        // don't forget to free the objectURL after a few seconds\r\n        setTimeout(() => {\r\n            URL.revokeObjectURL(objectUrl);\r\n        }, 5000);\r\n    }\r\n}\r\n\r\nexport {\r\n    chooseLines,\r\n    choosePattern,\r\n    downloadTextFile,\r\n};\r\n","import { ISize } from \"./interfaces/i-size\";\r\nimport { IPoint } from \"./interfaces/i-point\";\r\n\r\nclass InputImage {\r\n    private _size: ISize;\r\n\r\n    private readonly hiddenCanvas: HTMLCanvasElement;\r\n    private readonly hiddenContext: CanvasRenderingContext2D;\r\n    private readonly sourceImage: HTMLImageElement;\r\n    private valueArray: Uint8ClampedArray;\r\n\r\n    public constructor(image: HTMLImageElement) {\r\n        this.hiddenCanvas = document.createElement(\"canvas\");\r\n        this.hiddenContext = this.hiddenCanvas.getContext(\"2d\", { willReadFrequently: true });\r\n        this.sourceImage = image;\r\n        this._size = {\r\n            width: 0,\r\n            height: 0,\r\n        };\r\n\r\n        this.resize({ width: image.width, height: image.height });\r\n    }\r\n\r\n    public get size(): ISize {\r\n        return this._size;\r\n    }\r\n\r\n    public get width(): number {\r\n        return this._size.width;\r\n    }\r\n\r\n    public get height(): number {\r\n        return this._size.height;\r\n    }\r\n\r\n    public get sourceImageAspectRatio(): number {\r\n        return this.sourceImage.width / this.sourceImage.height;\r\n    }\r\n\r\n    public resize(wantedSize: ISize): void {\r\n        // the canvas handles image downsizing, however upsizing is handled manually in the sample method.\r\n        const wantedWidth = Math.min(this.sourceImage.width, wantedSize.width);\r\n        const wantedHeight = Math.min(this.sourceImage.height, wantedSize.height);\r\n\r\n        if (this.width !== wantedWidth || this.height !== wantedHeight) {\r\n            console.log(`Resize image from ${this.width}x${this.height} to ${wantedWidth}x${wantedHeight}.`);\r\n\r\n            this._size.width = wantedWidth;\r\n            this._size.height = wantedHeight;\r\n\r\n            this.hiddenCanvas.width = this.width;\r\n            this.hiddenCanvas.height = this.height;\r\n            this.hiddenContext.drawImage(this.sourceImage, 0, 0, this.width, this.height);\r\n\r\n            // retrieve all pixels at once because it is way faster that 1 by 1\r\n            const fullPixelsArray = this.hiddenContext.getImageData(0, 0, this.width, this.height).data;\r\n            this.valueArray = new Uint8ClampedArray(this.width * this.height);\r\n\r\n            for (let i = 0; i < this.valueArray.length; i++) {\r\n                const r = fullPixelsArray[4 * i];\r\n                const g = fullPixelsArray[4 * i + 1];\r\n                const b = fullPixelsArray[4 * i + 2];\r\n                this.valueArray[i] = (r + g + b) / 3;\r\n            }\r\n        }\r\n    }\r\n\r\n    /** Returns a value in [0, 1]. Performs linear interpolation. */\r\n    public sample(normalizedCoords: IPoint): number {\r\n        const pixelCoords: IPoint = {\r\n            x: normalizedCoords.x * (this._size.width - 1),\r\n            y: normalizedCoords.y * (this._size.height - 1),\r\n        }\r\n\r\n        const floorPixelCoords: IPoint = {\r\n            x: Math.floor(pixelCoords.x),\r\n            y: Math.floor(pixelCoords.y),\r\n        };\r\n        const fractPixelCoords: IPoint = {\r\n            x: pixelCoords.x - floorPixelCoords.x,\r\n            y: pixelCoords.y - floorPixelCoords.y,\r\n        };\r\n\r\n        const topLeft = this.getPixel(floorPixelCoords.x, floorPixelCoords.y);\r\n        const topRight = this.getPixel(floorPixelCoords.x + 1, floorPixelCoords.y);\r\n        const bottomLeft = this.getPixel(floorPixelCoords.x, floorPixelCoords.y + 1);\r\n        const bottomRight = this.getPixel(floorPixelCoords.x + 1, floorPixelCoords.y + 1);\r\n\r\n        const top = this.interpolate(topLeft, topRight, fractPixelCoords.x);\r\n        const bottom = this.interpolate(bottomLeft, bottomRight, fractPixelCoords.x);\r\n\r\n        const interpolated = this.interpolate(top, bottom, fractPixelCoords.y);\r\n\r\n        return interpolated / 255;\r\n    }\r\n\r\n    private interpolate(a: number, b: number, x: number): number {\r\n        return a * (1 - x) + b * x;\r\n    }\r\n\r\n    /** Returns a value in [0, 255]. No interpolation.\r\n     * @param x in pixels, must be an integer\r\n     * @param y in pixels, must be an integer\r\n     */\r\n    private getPixel(x: number, y: number): number {\r\n        if (x < 0 || y < 0 || x >= this.width || y >= this.height) {\r\n            return 0;\r\n        }\r\n\r\n        return this.valueArray[y * this.width + x];\r\n    }\r\n}\r\n\r\nexport { InputImage }\r\n","interface IPoint {\r\n    x: number;\r\n    y: number;\r\n}\r\n\r\nfunction distance(a: IPoint, b: IPoint): number {\r\n    const dX = a.x - b.x;\r\n    const dY = a.y - b.y;\r\n    return Math.sqrt(dX * dX + dY * dY);\r\n}\r\n\r\nfunction rotate(p: IPoint, angle: number): IPoint {\r\n    const cosAngle = Math.cos(angle);\r\n    const sinAngle = Math.sin(angle);\r\n\r\n    return {\r\n        x: p.x * cosAngle - p.y * sinAngle,\r\n        y: p.x * sinAngle + p.y * cosAngle,\r\n    };\r\n}\r\n\r\nexport { IPoint, distance, rotate }\r\n","import { IPoint } from \"../interfaces/i-point\";\r\nimport { ISize } from \"../interfaces/i-size\";\r\n\r\ntype LineWalker = (point: IPoint, normal: IPoint) => unknown;\r\n\r\nabstract class LinesBase {\r\n    /** Returns the suggested image size for optimum quality */\r\n    public abstract get suggestedImageSize(): ISize;\r\n    public abstract get nbLines(): number;\r\n\r\n    /**\r\n     * @param lineId integer\r\n     * @param step in canvas pixels\r\n     */\r\n    public abstract walkOnLine(lineId: number, step: number, callback: LineWalker): void;\r\n}\r\n\r\nexport { LineWalker, LinesBase }\r\n","import { distance, IPoint } from \"../interfaces/i-point\";\r\nimport { ISize } from \"../interfaces/i-size\";\r\nimport { Parameters } from \"../parameters\";\r\nimport { LineWalker, LinesBase } from \"./lines-base\";\r\n\r\nclass LinesPolygon extends LinesBase {\r\n    private readonly _center: IPoint;\r\n    private readonly _suggestedImageSize: ISize;\r\n    private readonly _linesSpacing: number;\r\n    private readonly _maxSegments: number;\r\n    private readonly _nbSides: number;\r\n\r\n    public constructor(imageSize: ISize, linesSpacing: number) {\r\n        super();\r\n\r\n        this._center = {\r\n            x: 0.5 * imageSize.width,\r\n            y: 0.5 * imageSize.height,\r\n        };\r\n\r\n        this._suggestedImageSize = {\r\n            width: imageSize.width,\r\n            height: imageSize.height,\r\n        };\r\n\r\n        this._linesSpacing = linesSpacing;\r\n        this._nbSides = Parameters.linesSides;\r\n\r\n        const diagonal = Math.sqrt(imageSize.width * imageSize.width + imageSize.height * imageSize.height);\r\n        this._maxSegments = Math.ceil(this._nbSides * diagonal / linesSpacing);\r\n    }\r\n\r\n    public get suggestedImageSize(): ISize {\r\n        return this._suggestedImageSize;\r\n    }\r\n\r\n    public get nbLines(): number {\r\n        return 1;\r\n    }\r\n\r\n    public walkOnLine(_lineId: number, step: number, callback: LineWalker): void {\r\n        const insideAngle = Math.PI * (this._nbSides - 2) / this._nbSides; // inside angle of a regular polygon\r\n        const dSideLength = 2 * this._linesSpacing / Math.tan(insideAngle / 2) / this._nbSides;\r\n        const startSideLength = 0.5 * dSideLength;\r\n\r\n        const orientationAngle = Parameters.orientationInRadians;\r\n        const cosOrientation = Math.cos(orientationAngle);\r\n        const sinOrientation = Math.sin(orientationAngle);\r\n\r\n        let startPoint: IPoint = {\r\n            x: this._center.x,\r\n            y: this._center.y,\r\n        };\r\n        for (let iSide = 0; iSide < this._maxSegments; iSide++) {\r\n            const sideLength = startSideLength + iSide * dSideLength;\r\n            const tangentAngle = Math.PI + (iSide % this._nbSides) * 2 * Math.PI / this._nbSides;\r\n\r\n            const endPoint: IPoint = {\r\n                x: startPoint.x + sideLength * Math.cos(tangentAngle),\r\n                y: startPoint.y + sideLength * Math.sin(tangentAngle),\r\n            };\r\n\r\n            const normalAngle = tangentAngle + orientationAngle + Math.PI / 2;\r\n            const normal: IPoint = { x: Math.cos(normalAngle), y: Math.sin(normalAngle) };\r\n\r\n            const segmentLength = distance(startPoint, endPoint);\r\n            for (let iSubstep = 0; iSubstep * step < segmentLength; iSubstep++) {\r\n                const currentLength = iSubstep * step;\r\n                const progression = currentLength / segmentLength;\r\n\r\n                const rawPointX = startPoint.x * (1 - progression) + endPoint.x * progression - this._center.x;\r\n                const rawPointY = startPoint.y * (1 - progression) + endPoint.y * progression - this._center.y;\r\n\r\n                const point: IPoint = {\r\n                    x: cosOrientation * rawPointX - sinOrientation * rawPointY + this._center.x,\r\n                    y: sinOrientation * rawPointX + cosOrientation * rawPointY + this._center.y,\r\n                };\r\n                callback(point, normal);\r\n            }\r\n\r\n            startPoint = endPoint;\r\n        }\r\n    }\r\n}\r\n\r\nexport { LinesPolygon };\r\n","import { ISize } from \"../interfaces/i-size\";\r\nimport { IPoint } from \"../interfaces/i-point\";\r\nimport { LineWalker, LinesBase } from \"./lines-base\";\r\n\r\nimport { Parameters } from \"../parameters\";\r\n\r\ninterface ILine {\r\n    start: IPoint;\r\n    end: IPoint;\r\n    length: number;\r\n}\r\n\r\nclass LinesSines extends LinesBase {\r\n    private readonly _suggestedImageSize: ISize;\r\n\r\n    private readonly _normal: IPoint;\r\n    private readonly _lines: ILine[];\r\n    private readonly _frequency: number;\r\n    private readonly _amplitude: number;\r\n\r\n    public constructor(imageSize: ISize, linesSpacing: number) {\r\n        super();\r\n\r\n        this._frequency = Parameters.linesFrequency;\r\n        this._amplitude = Parameters.linesAmplitude * 0.2 * Math.max(imageSize.width, imageSize.height);\r\n\r\n        this._normal = {\r\n            x: -Math.sin(Parameters.orientationInRadians),\r\n            y: Math.cos(Parameters.orientationInRadians),\r\n        };\r\n\r\n        this._lines = [];\r\n        this._lines.push(LinesSines.computeLine(0, linesSpacing, this._normal, imageSize));\r\n\r\n        const maximumLinesNeeded = this.computeMaximumLinesNeeded(imageSize, linesSpacing);\r\n        const maxAbsLine = maximumLinesNeeded / 2 + 1;\r\n        for (let iAbsLine = 1; iAbsLine < maxAbsLine; iAbsLine++) {\r\n            for (let iSide = -1; iSide <= 2; iSide += 2) {\r\n                const iLine = iAbsLine * iSide;\r\n                const line = LinesSines.computeLine(iLine, linesSpacing, this._normal, imageSize);\r\n                this._lines.push(line);\r\n            }\r\n        }\r\n        this._suggestedImageSize = { width: imageSize.width, height: imageSize.height };\r\n    }\r\n\r\n    public get suggestedImageSize(): ISize {\r\n        return this._suggestedImageSize;\r\n    }\r\n\r\n    public get nbLines(): number {\r\n        return this._lines.length;\r\n    }\r\n\r\n    public walkOnLine(lineId: number, step: number, callback: LineWalker): void {\r\n        const line = this._lines[lineId];\r\n\r\n        const computePoint = (completion: number): IPoint => {\r\n            const wave = this._amplitude * Math.sin(2 * Math.PI * completion * this._frequency);\r\n            return {\r\n                x: line.start.x * (1 - completion) + line.end.x * completion + wave * this._normal.x,\r\n                y: line.start.y * (1 - completion) + line.end.y * completion + wave * this._normal.y,\r\n            };\r\n        }\r\n\r\n        const maxNbSteps = line.length / step;\r\n        for (let iStep = 0; iStep < maxNbSteps; iStep++) {\r\n            const completion = (iStep * step) / line.length;\r\n\r\n            const point = computePoint(completion);\r\n            callback(point, this._normal);\r\n        }\r\n\r\n        const lastPoint = computePoint(1);\r\n        callback(lastPoint, this._normal);\r\n    }\r\n\r\n    private static computeLine(iLine: number, linesSpacing: number, normal: IPoint, imageSize: ISize): ILine {\r\n        const lineLength = Math.sqrt(imageSize.width * imageSize.width + imageSize.height * imageSize.height);\r\n        const tangent: IPoint = {\r\n            x: normal.y,\r\n            y: -normal.x,\r\n        };\r\n\r\n        const center: IPoint = {\r\n            x: 0.5 * imageSize.width + iLine * linesSpacing * normal.x,\r\n            y: 0.5 * imageSize.height + iLine * linesSpacing * normal.y,\r\n        };\r\n\r\n        const start: IPoint = {\r\n            x: center.x - 0.5 * lineLength * tangent.x,\r\n            y: center.y - 0.5 * lineLength * tangent.y,\r\n        };\r\n\r\n        const end: IPoint = {\r\n            x: center.x + 0.5 * lineLength * tangent.x,\r\n            y: center.y + 0.5 * lineLength * tangent.y,\r\n        };\r\n\r\n        return {\r\n            start,\r\n            end,\r\n            length: lineLength, // this is not mathematically accurate\r\n        };\r\n    }\r\n\r\n    private computeMaximumLinesNeeded(imageSize: ISize, linesSpacing: number): number {\r\n        const width = imageSize.width + 2 * this._amplitude;\r\n        const height = imageSize.height + 2 * this._amplitude;\r\n\r\n        const diagonal = Math.sqrt(width * width + height * height);\r\n        return Math.ceil(diagonal / linesSpacing);\r\n    }\r\n}\r\n\r\nexport { LinesSines }\r\n","import { IPoint } from \"../interfaces/i-point\";\r\nimport { ISize } from \"../interfaces/i-size\";\r\nimport { Parameters } from \"../parameters\";\r\nimport { LineWalker, LinesBase } from \"./lines-base\";\r\n\r\nclass LinesSpiral extends LinesBase {\r\n    private readonly _center: IPoint;\r\n    private readonly _suggestedImageSize: ISize;\r\n    private readonly _radiusGap: number;\r\n    private readonly _maxAngle: number;\r\n\r\n    public constructor(imageSize: ISize, linesSpacing: number) {\r\n        super();\r\n\r\n        this._center = {\r\n            x: 0.5 * imageSize.width,\r\n            y: 0.5 * imageSize.height,\r\n        };\r\n\r\n        this._suggestedImageSize = {\r\n            width: imageSize.width,\r\n            height: imageSize.height,\r\n        };\r\n\r\n        this._radiusGap = 0.5 * linesSpacing;\r\n\r\n        const diagonal = Math.sqrt(imageSize.width * imageSize.width + imageSize.height * imageSize.height);\r\n        const nbSemiCircles = Math.ceil(diagonal / linesSpacing);\r\n        this._maxAngle = nbSemiCircles * Math.PI;\r\n    }\r\n\r\n    public get suggestedImageSize(): ISize {\r\n        return this._suggestedImageSize;\r\n    }\r\n\r\n    public get nbLines(): number {\r\n        return 1;\r\n    }\r\n\r\n    public walkOnLine(_lineId: number, step: number, callback: LineWalker): void {\r\n        const orientation = Parameters.orientationInRadians;\r\n        const cosOrientation = Math.cos(orientation);\r\n        const sinOrientation = Math.sin(orientation);\r\n\r\n        let angle = 0;\r\n        while (angle < this._maxAngle) {\r\n            const cosAngle = Math.cos(angle);\r\n            const sinAngle = Math.sin(angle);\r\n\r\n            const semiCircleId = Math.ceil((angle - orientation) / Math.PI);\r\n            const radius = (semiCircleId + 0.125) * this._radiusGap;\r\n            const centerOffset = this._radiusGap * (0.5 - (semiCircleId % 2));\r\n\r\n            const point: IPoint = {\r\n                x: this._center.x + centerOffset * cosOrientation + radius * cosAngle,\r\n                y: this._center.y + centerOffset * sinOrientation + radius * sinAngle,\r\n            };\r\n            const normal: IPoint = {\r\n                x: -cosAngle,\r\n                y: -sinAngle,\r\n            };\r\n\r\n            callback(point, normal);\r\n\r\n            angle += step / radius;\r\n        }\r\n    }\r\n}\r\n\r\nexport { LinesSpiral }\r\n","import { ISize } from \"../interfaces/i-size\";\r\nimport { IPoint, distance } from \"../interfaces/i-point\";\r\nimport { LineWalker, LinesBase } from \"./lines-base\";\r\n\r\nimport { Parameters } from \"../parameters\";\r\n\r\ninterface ILine {\r\n    start: IPoint;\r\n    end: IPoint;\r\n    length: number;\r\n}\r\n\r\nenum ELinesOrientation {\r\n    HORIZONTAL,\r\n    VERTICAL,\r\n    DIAGONAL,\r\n}\r\n\r\nclass LinesStraightLines extends LinesBase {\r\n    private readonly _suggestedImageSize: ISize;\r\n\r\n    private readonly _normal: IPoint;\r\n    private readonly _lines: ILine[];\r\n\r\n    public constructor(imageSize: ISize, linesSpacing: number) {\r\n        super();\r\n\r\n        this._normal = {\r\n            x: -Math.sin(Parameters.orientationInRadians),\r\n            y: Math.cos(Parameters.orientationInRadians),\r\n        };\r\n\r\n        let linesOrientation = ELinesOrientation.DIAGONAL;\r\n        if (Parameters.orientationInDegrees % 180 === 90) {\r\n            linesOrientation = ELinesOrientation.VERTICAL;\r\n        } else if (Parameters.orientationInDegrees % 180 === 0) {\r\n            linesOrientation = ELinesOrientation.HORIZONTAL;\r\n        }\r\n\r\n        this._lines = [];\r\n        this._lines.push(LinesStraightLines.computeLine(0, linesSpacing, linesOrientation, this._normal, imageSize));\r\n\r\n        const maximumLinesNeeded = LinesStraightLines.computeMaximumLinesNeeded(imageSize, linesSpacing);\r\n        const maxAbsLine = maximumLinesNeeded / 2 + 1;\r\n        for (let iAbsLine = 1; iAbsLine < maxAbsLine; iAbsLine++) {\r\n            for (let iSide = -1; iSide <= 2; iSide += 2) {\r\n                const iLine = iAbsLine * iSide;\r\n                const line = LinesStraightLines.computeLine(iLine, linesSpacing, linesOrientation, this._normal, imageSize);\r\n\r\n                const ROUNDING_ERROR = 0.1;\r\n\r\n                const xOutOfBounds = line.start.x < -ROUNDING_ERROR || line.start.x > imageSize.width - 1 + ROUNDING_ERROR;\r\n                const yOutOfBounds = line.start.y < -ROUNDING_ERROR || line.start.y > imageSize.height - 1 + ROUNDING_ERROR;\r\n\r\n                if (xOutOfBounds || yOutOfBounds) {\r\n                    break;\r\n                }\r\n\r\n                this._lines.push(line);\r\n            }\r\n        }\r\n        this._suggestedImageSize = LinesStraightLines.computeBestImageSize(imageSize, this._lines.length, linesOrientation);\r\n    }\r\n\r\n    public get suggestedImageSize(): ISize {\r\n        return this._suggestedImageSize;\r\n    }\r\n\r\n    public get nbLines(): number {\r\n        return this._lines.length;\r\n    }\r\n\r\n    public walkOnLine(lineId: number, step: number, callback: LineWalker): void {\r\n        const line = this._lines[lineId];\r\n\r\n        function computePoint(completion: number): IPoint {\r\n            return {\r\n                x: line.start.x * (1 - completion) + line.end.x * completion,\r\n                y: line.start.y * (1 - completion) + line.end.y * completion,\r\n            };\r\n        }\r\n\r\n        const maxNbSteps = line.length / step;\r\n        for (let iStep = 0; iStep < maxNbSteps; iStep++) {\r\n            const completion = (iStep * step) / line.length;\r\n\r\n            const point = computePoint(completion);\r\n            callback(point, this._normal);\r\n        }\r\n\r\n        const lastPoint = computePoint(1);\r\n        callback(lastPoint, this._normal);\r\n    }\r\n\r\n    private static computeLine(iLine: number, linesSpacing: number, linesOrientation: ELinesOrientation, normal: IPoint, imageSize: ISize): ILine {\r\n        const tangent: IPoint = {\r\n            x: normal.y,\r\n            y: -normal.x,\r\n        };\r\n\r\n        const start: IPoint = {\r\n            x: 0.5 * imageSize.width + iLine * linesSpacing * normal.x,\r\n            y: 0.5 * imageSize.height + iLine * linesSpacing * normal.y,\r\n        };\r\n        const end: IPoint = { x: start.x, y: start.y };\r\n\r\n        const maxX = imageSize.width - 1;\r\n        const maxY = imageSize.height - 1;\r\n\r\n        if (linesOrientation === ELinesOrientation.HORIZONTAL) {\r\n            start.x = 0;\r\n            end.x = maxX;\r\n        } else if (linesOrientation === ELinesOrientation.VERTICAL) {\r\n            start.y = 0;\r\n            end.y = maxY;\r\n        } else {\r\n            const startAdjustment = Math.min(start.x / tangent.x, start.y / tangent.y);\r\n            start.x -= startAdjustment * tangent.x;\r\n            start.y -= startAdjustment * tangent.y;\r\n\r\n            const endAdjustment = Math.min((maxX - end.x) / tangent.x, (maxY - end.y) / tangent.y);\r\n            end.x += endAdjustment * tangent.x;\r\n            end.y += endAdjustment * tangent.y;\r\n        }\r\n\r\n        return {\r\n            start,\r\n            end,\r\n            length: distance(start, end),\r\n        };\r\n    }\r\n\r\n    private static computeBestImageSize(imageSize: ISize, nbLines: number, orientation: ELinesOrientation): ISize {\r\n        if (orientation === ELinesOrientation.HORIZONTAL) {\r\n            return {\r\n                width: imageSize.width,\r\n                height: nbLines,\r\n            };\r\n        } else if (orientation === ELinesOrientation.VERTICAL) {\r\n            return {\r\n                width: nbLines,\r\n                height: imageSize.height,\r\n            };\r\n        }\r\n\r\n        return {\r\n            width: imageSize.width,\r\n            height: imageSize.height,\r\n        };\r\n    }\r\n\r\n    private static computeMaximumLinesNeeded(imageSize: ISize, linesSpacing: number): number {\r\n        const diagonal = Math.sqrt(imageSize.width * imageSize.width + imageSize.height * imageSize.height)\r\n        return Math.ceil(diagonal / linesSpacing);\r\n    }\r\n}\r\n\r\nexport { LinesStraightLines }\r\n","import { Parameters } from \"./parameters\";\r\nimport { InputImage } from \"./input-image\";\r\n\r\nimport { PlotterBase } from \"./plotter/plotter-base\";\r\nimport { PlotterCanvas2D } from \"./plotter/plotter-canvas-2d\";\r\nimport { PlotterSVG } from \"./plotter/plotter-svg\";\r\n\r\nimport * as Helpers from \"./helpers\";\r\n\r\nimport \"./page-interface-generated\";\r\n\r\nfunction plot(image: InputImage, plotter: PlotterBase): void {\r\n    const start = performance.now();\r\n\r\n    if (image == null) {\r\n        console.log(\"Image not loaded!\");\r\n        return;\r\n    }\r\n\r\n    plotter.resize();\r\n\r\n    const imageFitting = plotter.fitImage(image.sourceImageAspectRatio);\r\n\r\n    const baseLineSpacing = 1 / Parameters.linesCount;\r\n    const linesSpacing = baseLineSpacing * imageFitting.zoomFactor;\r\n\r\n    const lines = Helpers.chooseLines(imageFitting.sizeInPlotter, linesSpacing);\r\n    const pattern = Helpers.choosePattern(imageFitting, linesSpacing);\r\n\r\n    image.resize(lines.suggestedImageSize);\r\n\r\n    const displayInfos = pattern.buildPlotterInfos();\r\n    plotter.initialize(displayInfos);\r\n\r\n    for (let iLine = 0; iLine < lines.nbLines; iLine++) {\r\n        pattern.drawLine(lines, iLine, image, plotter);\r\n    }\r\n\r\n    plotter.finalize();\r\n    console.log(`Plotting took ${performance.now() - start} ms.`);\r\n}\r\n\r\nlet inputImage: InputImage = null;\r\nconst canvasPlotter = new PlotterCanvas2D();\r\n\r\nfunction plotOnCanvas(): void {\r\n    plot(inputImage, canvasPlotter);\r\n}\r\nParameters.addRedrawObserver(plotOnCanvas);\r\n\r\nfunction updateBlur(blur: number): void {\r\n    canvasPlotter.blur = blur;\r\n}\r\nParameters.addBlurChangeObserver(updateBlur);\r\nupdateBlur(Parameters.blur);\r\n\r\nParameters.addDownloadObserver(() => {\r\n    const svgPlotter = new PlotterSVG();\r\n    plot(inputImage, svgPlotter);\r\n    const svgString = svgPlotter.export();\r\n    const filename = \"image-as-sines.svg\";\r\n    Helpers.downloadTextFile(svgString, filename);\r\n});\r\n\r\nfunction onImageLoad(image: HTMLImageElement): void {\r\n    inputImage = new InputImage(image);\r\n    Page.Canvas.showLoader(false);\r\n    plotOnCanvas();\r\n}\r\nParameters.addFileUploadObserver(onImageLoad);\r\n\r\nPage.Canvas.showLoader(true);\r\nconst defaultImage = new Image();\r\ndefaultImage.addEventListener(\"load\", () => {\r\n    onImageLoad(defaultImage);\r\n});\r\ndefaultImage.src = \"./resources/cat.jpg\";\r\n","import \"./page-interface-generated\";\r\n\r\nconst controlId = {\r\n    UPLOAD_INPUT_IMAGE: \"input-image-upload-button\",\r\n    LINES_TYPE: \"lines-type-tabs-id\",\r\n    LINES_COUNT: \"lines-count-range-id\",\r\n    ORIENTATION: \"orientation-range-id\",\r\n    LINES_SIDES: \"lines-sides-range-id\",\r\n    LINES_AMPLITUDE: \"lines-amplitude-range-id\",\r\n    LINES_FREQUENCY: \"lines-frequency-range-id\",\r\n    PATTERN: \"pattern-tabs-id\",\r\n    AMPLITUDE: \"max-amplitude-range-id\",\r\n    FREQUENCY: \"max-frequency-range-id\",\r\n    ANGLE: \"angle-range-id\",\r\n    WAVE_SQUARENESS: \"wave-squareness-range-id\",\r\n    LINE_THICKNESS: \"line-thickness-range-id\",\r\n    INVERT_COLORS: \"invert-colors-checkbox-id\",\r\n    BLUR: \"blur-range-id\",\r\n    DOWNLOAD: \"result-download-id\",\r\n};\r\n\r\nenum ELinesType {\r\n    STRAIGHT = \"0\",\r\n    SPIRAL = \"1\",\r\n    POLYGON = \"2\",\r\n    SINES = \"3\",\r\n}\r\n\r\nenum EPattern {\r\n    WAVES = \"0\",\r\n    DITHERING = \"1\",\r\n}\r\n\r\ntype RedrawObserver = () => unknown;\r\nconst redrawObservers: RedrawObserver[] = [];\r\nfunction triggerRedraw(): void {\r\n    for (const observer of redrawObservers) {\r\n        observer();\r\n    }\r\n}\r\n\r\nPage.Tabs.addObserver(controlId.LINES_TYPE, triggerRedraw);\r\nPage.Range.addLazyObserver(controlId.LINES_COUNT, triggerRedraw);\r\nPage.Range.addLazyObserver(controlId.ORIENTATION, triggerRedraw);\r\nPage.Range.addLazyObserver(controlId.LINES_SIDES, triggerRedraw);\r\nPage.Range.addLazyObserver(controlId.LINES_AMPLITUDE, triggerRedraw);\r\nPage.Range.addLazyObserver(controlId.LINES_FREQUENCY, triggerRedraw);\r\nPage.Tabs.addObserver(controlId.PATTERN, triggerRedraw);\r\nPage.Range.addLazyObserver(controlId.AMPLITUDE, triggerRedraw);\r\nPage.Range.addLazyObserver(controlId.FREQUENCY, triggerRedraw);\r\nPage.Range.addLazyObserver(controlId.ANGLE, triggerRedraw);\r\nPage.Range.addLazyObserver(controlId.WAVE_SQUARENESS, triggerRedraw);\r\nPage.Range.addLazyObserver(controlId.LINE_THICKNESS, triggerRedraw);\r\nPage.Checkbox.addObserver(controlId.INVERT_COLORS, triggerRedraw);\r\nPage.Canvas.Observers.canvasResize.push(triggerRedraw);\r\n\r\nabstract class Parameters {\r\n    public static addFileUploadObserver(callback: (image: HTMLImageElement) => unknown): void {\r\n        Page.FileControl.addUploadObserver(controlId.UPLOAD_INPUT_IMAGE, (filesList: FileList) => {\r\n            if (filesList.length === 1) {\r\n                Page.Canvas.showLoader(true);\r\n                const reader = new FileReader();\r\n                reader.onload = () => {\r\n                    const image = new Image();\r\n                    image.addEventListener(\"load\", () => {\r\n                        callback(image);\r\n                    })\r\n                    image.src = reader.result as string;\r\n                };\r\n                reader.readAsDataURL(filesList[0]);\r\n            }\r\n        });\r\n    }\r\n\r\n    public static get linesType(): ELinesType {\r\n        return Page.Tabs.getValues(controlId.LINES_TYPE)[0] as ELinesType;\r\n    }\r\n\r\n    public static get linesCount(): number {\r\n        return Page.Range.getValue(controlId.LINES_COUNT);\r\n    }\r\n\r\n    public static get orientationInDegrees(): number {\r\n        return Page.Range.getValue(controlId.ORIENTATION);\r\n    }\r\n    public static get orientationInRadians(): number {\r\n        return this.orientationInDegrees / 180 * Math.PI;\r\n    }\r\n\r\n    public static get linesSides(): number {\r\n        return Page.Range.getValue(controlId.LINES_SIDES);\r\n    }\r\n\r\n    public static get linesAmplitude(): number {\r\n        return Page.Range.getValue(controlId.LINES_AMPLITUDE);\r\n    }\r\n\r\n    public static get linesFrequency(): number {\r\n        return Page.Range.getValue(controlId.LINES_FREQUENCY);\r\n    }\r\n\r\n    public static get pattern(): EPattern {\r\n        return Page.Tabs.getValues(controlId.PATTERN)[0] as EPattern;\r\n    }\r\n\r\n    public static get maxAmplitude(): number {\r\n        return Page.Range.getValue(controlId.AMPLITUDE);\r\n    }\r\n\r\n    public static get maxFrequency(): number {\r\n        return Page.Range.getValue(controlId.FREQUENCY);\r\n    }\r\n\r\n    public static get angle(): number {\r\n        return Page.Range.getValue(controlId.ANGLE);\r\n    }\r\n\r\n    public static get waveSquareness(): number {\r\n        return Page.Range.getValue(controlId.WAVE_SQUARENESS);\r\n    }\r\n\r\n    public static get lineThickness(): number {\r\n        return Page.Range.getValue(controlId.LINE_THICKNESS);\r\n    }\r\n\r\n    public static get invertColors(): boolean {\r\n        return Page.Checkbox.isChecked(controlId.INVERT_COLORS);\r\n    }\r\n\r\n    public static addRedrawObserver(callback: RedrawObserver): void {\r\n        redrawObservers.push(callback);\r\n    }\r\n\r\n    public static get blur(): number {\r\n        return Page.Range.getValue(controlId.BLUR);\r\n    }\r\n    public static addBlurChangeObserver(callback: (newBlur: number) => unknown): void {\r\n        Page.Range.addObserver(controlId.BLUR, callback);\r\n    }\r\n\r\n    public static addDownloadObserver(callback: () => unknown): void {\r\n        Page.FileControl.addDownloadObserver(controlId.DOWNLOAD, callback);\r\n    }\r\n}\r\n\r\nfunction udpateControlsVisibility(): void {\r\n    Page.Controls.setVisibility(controlId.PATTERN, false);\r\n\r\n    const type = Parameters.linesType;\r\n    Page.Controls.setVisibility(controlId.LINES_SIDES, type === ELinesType.POLYGON);\r\n    Page.Controls.setVisibility(controlId.LINES_AMPLITUDE, type === ELinesType.SINES);\r\n    Page.Controls.setVisibility(controlId.LINES_FREQUENCY, type === ELinesType.SINES);\r\n\r\n    const pattern = Parameters.pattern;\r\n    Page.Controls.setVisibility(controlId.ANGLE, pattern === EPattern.WAVES);\r\n    Page.Controls.setVisibility(controlId.WAVE_SQUARENESS, pattern === EPattern.WAVES);\r\n    Page.Controls.setVisibility(controlId.LINE_THICKNESS, pattern === EPattern.WAVES);\r\n}\r\nPage.Tabs.addObserver(controlId.LINES_TYPE, udpateControlsVisibility);\r\nPage.Tabs.addObserver(controlId.PATTERN, udpateControlsVisibility);\r\nudpateControlsVisibility();\r\n\r\nlet lastAmplitude: number | null = null;\r\nlet lastFrequency: number | null = null;\r\nPage.Tabs.addObserver(controlId.PATTERN, function updateControlsValue(): void {\r\n    const pattern = Parameters.pattern;\r\n\r\n    const previousAmplitude = Page.Range.getValue(controlId.AMPLITUDE);\r\n    const previousFrequency = Page.Range.getValue(controlId.FREQUENCY);\r\n\r\n    let newAmplitude = lastAmplitude;\r\n    let newFrequency = lastFrequency;\r\n    if (pattern === EPattern.WAVES) {\r\n        newAmplitude = (newAmplitude === null) ? 1 : newAmplitude;\r\n        newFrequency = (newFrequency === null) ? 0.4 : newFrequency;\r\n    } else if (pattern === EPattern.DITHERING) {\r\n        newAmplitude = (newAmplitude === null) ? 0.5 : newAmplitude;\r\n        newFrequency = (newFrequency === null) ? 0.5 : newFrequency;\r\n    }\r\n\r\n    Page.Range.setValue(controlId.AMPLITUDE, newAmplitude);\r\n    Page.Range.setValue(controlId.FREQUENCY, newFrequency);\r\n    lastAmplitude = previousAmplitude;\r\n    lastFrequency = previousFrequency;\r\n\r\n    triggerRedraw();\r\n});\r\n\r\nexport { Parameters, ELinesType, EPattern }\r\n","import { InputImage } from \"../input-image\";\r\nimport { LinesBase } from \"../lines/lines-base\";\r\nimport { IPlotterInfo, PlotterBase } from \"../plotter/plotter-base\";\r\n\r\nabstract class PatternBase {\r\n    public abstract buildPlotterInfos(): IPlotterInfo;\r\n    public abstract drawLine(lines: LinesBase, lineId: number, image: InputImage, plotter: PlotterBase): void;\r\n}\r\n\r\nexport { PatternBase };\r\n","import { InputImage } from \"../input-image\";\r\nimport { IPoint } from \"../interfaces/i-point\";\r\nimport { LinesBase } from \"../lines/lines-base\";\r\nimport { Parameters } from \"../parameters\";\r\nimport { PlotterBase, IImageFitting, IPlotterInfo } from \"../plotter/plotter-base\";\r\nimport { PatternBase } from \"./pattern-base\";\r\n\r\ntype SamplingFunction = (inputImage: InputImage, coords: IPoint) => number;\r\n\r\nfunction clamp(min: number, max: number, x: number): number {\r\n    if (x < min) {\r\n        return min;\r\n    } else if (x > max) {\r\n        return max;\r\n    }\r\n    return x;\r\n}\r\n\r\nconst portionsSeeds: number[] = [];\r\n\r\nclass PatternDithering extends PatternBase {\r\n    private readonly samplingFunction: SamplingFunction;\r\n\r\n    private readonly imageFitting: IImageFitting;\r\n\r\n    private readonly linesThickness: number;\r\n\r\n    private readonly samplesPerPortion: number;\r\n    private readonly step: number;\r\n\r\n    private static readonly ditheringPatterns: number[][] = [\r\n        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n        [0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0],\r\n        [0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0],\r\n        [0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0],\r\n        [0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0],\r\n        [1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0],\r\n        [1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0],\r\n        [1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0],\r\n        [1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0],\r\n        [1, 0, 1, 0, 1, 1, 0, 1, 1, 0, 1, 0, 1, 0, 1, 0],\r\n        [1, 0, 1, 1, 0, 1, 0, 1, 1, 0, 1, 1, 0, 1, 1, 0],\r\n        [1, 0, 1, 1, 0, 1, 1, 0, 1, 1, 0, 1, 1, 0, 1, 1],\r\n        [1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1],\r\n        [1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1],\r\n        [1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1],\r\n        [1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1],\r\n        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],\r\n    ];\r\n\r\n    public constructor(imageFitting: IImageFitting, linesSpacing: number) {\r\n        super();\r\n\r\n        this.samplingFunction = PatternDithering.chooseBestSamplingFunction();\r\n\r\n        this.imageFitting = imageFitting;\r\n\r\n        this.linesThickness = Math.max(1, Parameters.maxAmplitude * linesSpacing);\r\n\r\n        const MIN_FREQUENCY = 10;\r\n        const MAX_FREQUENCY = 1000;\r\n        const xFrequency = Parameters.maxFrequency;\r\n        const baseMaxFrequency = MIN_FREQUENCY * (1 - xFrequency) + MAX_FREQUENCY * xFrequency;\r\n\r\n        const MIN_SAMPLE_FREQUENCY = 1000;\r\n        this.samplesPerPortion = Math.ceil(MIN_SAMPLE_FREQUENCY / baseMaxFrequency);\r\n        const sampleFrequency = baseMaxFrequency * this.samplesPerPortion / imageFitting.zoomFactor;\r\n        this.step = 1 / sampleFrequency;\r\n    }\r\n\r\n    public buildPlotterInfos(): IPlotterInfo {\r\n        return {\r\n            backgroundColor: Parameters.invertColors ? \"black\" : \"white\",\r\n            lineColor: Parameters.invertColors ? \"white\" : \"black\",\r\n            lineThickness: this.linesThickness,\r\n            roundLinecap: false,\r\n            blur: Parameters.blur,\r\n        };\r\n    }\r\n\r\n    public drawLine(lines: LinesBase, lineId: number, image: InputImage, plotter: PlotterBase): void {\r\n        if (typeof portionsSeeds[lineId] === \"undefined\") {\r\n            portionsSeeds[lineId] = Math.round(1000 * Math.random());\r\n        }\r\n        const portionSeed = portionsSeeds[lineId]; // avoid alignments that could lead to visual artifacts\r\n\r\n        let iSample = 0;\r\n        let isDarkPortion = false;\r\n        lines.walkOnLine(lineId, this.step, (point: IPoint) => {\r\n            const normalizedCoords = this.imageFitting.pixelToRelative(point);\r\n\r\n            const outOfImage = normalizedCoords.x < 0 || normalizedCoords.x > 1 || normalizedCoords.y < 0 || normalizedCoords.y > 1;\r\n            if (outOfImage) {\r\n                if (plotter.hasStartedALine) {\r\n                    plotter.endLine();\r\n                }\r\n                isDarkPortion = false;\r\n            } else {\r\n                if (iSample % this.samplesPerPortion < 0.1) {\r\n                    const localDarkness = clamp(0, 1, this.samplingFunction(image, normalizedCoords));\r\n                    const iQuantifiedColor = Math.floor(localDarkness * 0.99 * PatternDithering.ditheringPatterns.length);\r\n                    const ditheringPattern = PatternDithering.ditheringPatterns[iQuantifiedColor];\r\n\r\n                    const iPortion = Math.floor(iSample / this.samplesPerPortion) + portionSeed;\r\n                    isDarkPortion = ditheringPattern[Math.floor(iPortion % ditheringPattern.length)] > 0.5;\r\n                }\r\n\r\n                if (isDarkPortion) {\r\n                    if (!plotter.hasStartedALine) {\r\n                        plotter.startLine();\r\n                    }\r\n                    const absolutePoint = this.imageFitting.relativeToAbsolute(point);\r\n                    plotter.addPointToLine(absolutePoint.x, absolutePoint.y);\r\n                } else if (plotter.hasStartedALine) {\r\n                    const absolutePoint = this.imageFitting.relativeToAbsolute(point);\r\n                    plotter.addPointToLine(absolutePoint.x, absolutePoint.y);\r\n                    plotter.endLine();\r\n                }\r\n\r\n                iSample++;\r\n            }\r\n        });\r\n\r\n        if (plotter.hasStartedALine) {\r\n            plotter.endLine();\r\n        }\r\n    }\r\n\r\n    private static chooseBestSamplingFunction(): SamplingFunction {\r\n        if (Parameters.invertColors) {\r\n            return (inputImage: InputImage, coords: IPoint) => inputImage.sample(coords);\r\n        } else {\r\n            return (inputImage: InputImage, coords: IPoint) => 1 - inputImage.sample(coords);\r\n        }\r\n    }\r\n}\r\n\r\nexport { PatternDithering };\r\n","import { InputImage } from \"../input-image\";\r\nimport { IPoint } from \"../interfaces/i-point\";\r\nimport { LinesBase } from \"../lines/lines-base\";\r\nimport { Parameters } from \"../parameters\";\r\nimport { PlotterBase, IImageFitting, IPlotterInfo } from \"../plotter/plotter-base\";\r\nimport { PatternBase } from \"./pattern-base\";\r\n\r\ntype WaveFunction = (phase: number, amplitude: number) => number;\r\ntype NormalRotationFunction = (normal: IPoint) => IPoint;\r\ntype SamplingFunction = (inputImage: InputImage, coords: IPoint) => number;\r\n\r\nclass PatternWave extends PatternBase {\r\n    private readonly waveFunction: WaveFunction;\r\n    private readonly normalRotationFunction: NormalRotationFunction;\r\n    private readonly samplingFunction: SamplingFunction;\r\n\r\n    private readonly imageFitting: IImageFitting;\r\n\r\n    private readonly maxAmplitude: number;\r\n    private readonly maxFrequency: number;\r\n    private readonly step: number;\r\n\r\n    public constructor(imageFitting: IImageFitting, linesSpacing: number) {\r\n        super();\r\n\r\n        this.waveFunction = PatternWave.computeWaveFunction();\r\n        this.normalRotationFunction = PatternWave.computeNormalRotationFunction();\r\n        this.samplingFunction = PatternWave.chooseBestSamplingFunction();\r\n\r\n        this.imageFitting = imageFitting;\r\n\r\n        const baseMaxFrequency = 2500 * Parameters.maxFrequency;\r\n        this.maxFrequency = baseMaxFrequency / imageFitting.zoomFactor;\r\n\r\n        this.maxAmplitude = 0.5 * (linesSpacing - Parameters.lineThickness) * Parameters.maxAmplitude;\r\n\r\n        const samplesPerPixel = Math.max(1, 2 * this.maxFrequency);\r\n        this.step = 1 / samplesPerPixel;\r\n    }\r\n\r\n    public buildPlotterInfos(): IPlotterInfo {\r\n        return {\r\n            backgroundColor: Parameters.invertColors ? \"black\" : \"white\",\r\n            lineColor: Parameters.invertColors ? \"white\" : \"black\",\r\n            lineThickness: Parameters.lineThickness,\r\n            roundLinecap: true,\r\n            blur: Parameters.blur,\r\n        };\r\n    }\r\n\r\n    public drawLine(lines: LinesBase, lineId: number, image: InputImage, plotter: PlotterBase): void {\r\n        let phase = 0;\r\n\r\n        lines.walkOnLine(lineId, this.step, (point: IPoint, normal: IPoint) => {\r\n            const normalizedCoords = this.imageFitting.pixelToRelative(point);\r\n\r\n            const outOfImage = normalizedCoords.x < 0 || normalizedCoords.x > 1 || normalizedCoords.y < 0 || normalizedCoords.y > 1;\r\n            if (outOfImage) {\r\n                if (plotter.hasStartedALine) {\r\n                    plotter.endLine();\r\n                }\r\n            } else {\r\n                const localDarkness = this.samplingFunction(image, normalizedCoords);\r\n\r\n                const localAmplitude = localDarkness * this.maxAmplitude;\r\n                const localHeight = this.waveFunction(phase, localAmplitude);\r\n\r\n                const rotatedNormal = this.normalRotationFunction(normal);\r\n                const dX = localHeight * rotatedNormal.x;\r\n                const dY = localHeight * rotatedNormal.y;\r\n\r\n                const absolutePoint = this.imageFitting.relativeToAbsolute(point);\r\n                if (!plotter.hasStartedALine) {\r\n                    plotter.startLine();\r\n                }\r\n                plotter.addPointToLine(absolutePoint.x + dX, absolutePoint.y + dY);\r\n\r\n                const localFrequency = localDarkness * this.maxFrequency;\r\n                phase += localFrequency * this.step;\r\n            }\r\n        });\r\n\r\n        if (plotter.hasStartedALine) {\r\n            plotter.endLine();\r\n        }\r\n    }\r\n\r\n    private static computeNormalRotationFunction(): NormalRotationFunction {\r\n        const angle = Parameters.angle * 2 * Math.PI;\r\n        const cosAngle = Math.cos(angle);\r\n        const sinAngle = Math.sin(angle);\r\n        const lengthAdjustment = 1 / cosAngle; // to maintain the waves height no matter the angle\r\n        return (normal: IPoint): IPoint => {\r\n            return {\r\n                x: (cosAngle * normal.x - sinAngle * normal.y) * lengthAdjustment,\r\n                y: (sinAngle * normal.x + cosAngle * normal.y) * lengthAdjustment,\r\n            };\r\n        };\r\n    }\r\n\r\n    private static computeWaveFunction(): WaveFunction {\r\n        if (Parameters.waveSquareness < 0.005) {\r\n            return (phase: number, amplitude: number) => amplitude * Math.sin(phase);\r\n        }\r\n\r\n        const sharpness = 1 - 0.99 * Parameters.waveSquareness;\r\n        return (phase: number, amplitude: number) => {\r\n            const sinPhase = Math.sin(phase);\r\n            return amplitude * Math.sign(sinPhase) * Math.pow(Math.abs(sinPhase), sharpness);\r\n        };\r\n    }\r\n\r\n    private static chooseBestSamplingFunction(): SamplingFunction {\r\n        if (Parameters.invertColors) {\r\n            return (inputImage: InputImage, coords: IPoint) => Math.sqrt(inputImage.sample(coords));\r\n        } else {\r\n            return (inputImage: InputImage, coords: IPoint) => Math.sqrt(1.001 - inputImage.sample(coords));\r\n        }\r\n    }\r\n}\r\n\r\n\r\nexport { PatternWave };\r\n","import { IPoint } from \"../interfaces/i-point\";\r\nimport { ISize } from \"../interfaces/i-size\";\r\n\r\ninterface IPlotterInfo {\r\n    backgroundColor: string;\r\n    lineColor: string;\r\n    lineThickness: number;\r\n    roundLinecap: boolean;\r\n    blur: number;\r\n}\r\n\r\ninterface IImageFitting {\r\n    sizeInPlotter: ISize,\r\n    relativeToAbsolute: (relativeCoords: IPoint) => IPoint;\r\n    pixelToRelative: (pixelCoords: IPoint) => IPoint;\r\n    zoomFactor: number,\r\n};\r\n\r\nconst ANGLE_THRESHOLD = Math.PI * 0.003;\r\n\r\nabstract class PlotterBase {\r\n    public abstract resize(): void;\r\n    public abstract initialize(infos: IPlotterInfo): void;\r\n    public abstract finalize(): void;\r\n\r\n    public get hasStartedALine(): boolean {\r\n        return this._hasStartedALine;\r\n    }\r\n\r\n    public startLine(): void {\r\n        this._hasStartedALine = true;\r\n        this.startLineInternal();\r\n\r\n        this.lastDrawnPoint = null;\r\n        this.potentialNextPoint = null;\r\n    }\r\n\r\n    public addPointToLine(x: number, y: number): void {\r\n        const newPoint: IPoint = { x, y };\r\n\r\n        if (this.lastDrawnPoint === null) {\r\n            this.lastDrawnPoint = newPoint;\r\n            this.addFirstPointToLineInternal(this.lastDrawnPoint.x, this.lastDrawnPoint.y);\r\n        } else if (this.potentialNextPoint === null) {\r\n            this.potentialNextPoint = newPoint;\r\n        } else {\r\n            const angle = PlotterBase.computeAngle(this.lastDrawnPoint, this.potentialNextPoint, newPoint);\r\n\r\n            if (angle > ANGLE_THRESHOLD) {\r\n                this.addPointToLineInternal(this.potentialNextPoint.x, this.potentialNextPoint.y); // this point cannot be skipped because it defines a significant angle\r\n                this.lastDrawnPoint = this.potentialNextPoint;\r\n            }\r\n            this.potentialNextPoint = newPoint;\r\n        }\r\n    }\r\n\r\n    public endLine(): void {\r\n        if (this.potentialNextPoint !== null) {\r\n            this.addPointToLineInternal(this.potentialNextPoint.x, this.potentialNextPoint.y);\r\n        }\r\n        this.lastDrawnPoint = null;\r\n        this.potentialNextPoint = null;\r\n\r\n        this.endLineInternal();\r\n        this._hasStartedALine = false;\r\n    }\r\n\r\n    public fitImage(imageAspectRatio: number): IImageFitting {\r\n        const plotterSize = this.size;\r\n        const displayAspectRatio = plotterSize.width / plotterSize.height;\r\n\r\n        const sizeInPlotter: ISize = {\r\n            width: plotterSize.width,\r\n            height: plotterSize.height,\r\n        };\r\n        if (imageAspectRatio > displayAspectRatio) {\r\n            sizeInPlotter.height = Math.floor(sizeInPlotter.height * displayAspectRatio / imageAspectRatio);\r\n        } else if (imageAspectRatio < displayAspectRatio) {\r\n            sizeInPlotter.width = Math.floor(sizeInPlotter.width * imageAspectRatio / displayAspectRatio);\r\n        }\r\n\r\n        const offSetX = 0.5 * (plotterSize.width - sizeInPlotter.width);\r\n        const offSetY = 0.5 * (plotterSize.height - sizeInPlotter.height);\r\n        const relativeToAbsolute = (relativeCoords: IPoint): IPoint => {\r\n            return {\r\n                x: relativeCoords.x + offSetX,\r\n                y: relativeCoords.y + offSetY,\r\n            };\r\n        };\r\n\r\n        const minSide = Math.min(sizeInPlotter.width, sizeInPlotter.height);\r\n        const baseMinSide = Math.min(imageAspectRatio, 1 / imageAspectRatio);\r\n\r\n        return {\r\n            sizeInPlotter,\r\n            relativeToAbsolute,\r\n            pixelToRelative: (pixelCoordinates: IPoint) => {\r\n                return {\r\n                    x: pixelCoordinates.x / (sizeInPlotter.width - 1),\r\n                    y: pixelCoordinates.y / (sizeInPlotter.height - 1),\r\n                }\r\n            },\r\n            zoomFactor: minSide / baseMinSide,\r\n        };\r\n    }\r\n\r\n    protected abstract get size(): ISize;\r\n    protected abstract startLineInternal(): void;\r\n    protected abstract addFirstPointToLineInternal(x: number, y: number): void;\r\n    protected abstract addPointToLineInternal(x: number, y: number): void;\r\n    protected abstract endLineInternal(): void;\r\n\r\n    /** Smallest absolute angle difference between vectors p2-p1 and p3-p2 */\r\n    private static computeAngle(p1: IPoint, p2: IPoint, p3: IPoint): number {\r\n        const angle1 = Math.atan2(p2.y - p1.y, p2.x - p1.x); // in [-PI,PI] (warped)\r\n        const angle2 = Math.atan2(p3.y - p2.y, p3.x - p2.x); // in [-PI,PI] (warped)\r\n\r\n        const diffAngle = Math.abs(angle1 - angle2); // in [0, 2 * PI] (warped)\r\n        return Math.min(diffAngle, 2 * Math.PI - diffAngle);\r\n    }\r\n\r\n    private lastDrawnPoint: IPoint;\r\n    private potentialNextPoint: IPoint;\r\n    private _hasStartedALine: boolean = false;\r\n}\r\n\r\nexport { PlotterBase, IImageFitting, IPlotterInfo, ISize }\r\n","import { PlotterBase, IPlotterInfo, ISize } from \"./plotter-base\";\r\n\r\nimport \"../page-interface-generated\";\r\n\r\nclass PlotterCanvas2D extends PlotterBase {\r\n    private readonly canvas: HTMLCanvasElement;\r\n    private readonly context: CanvasRenderingContext2D;\r\n    private readonly cssPixel: number;\r\n\r\n    public constructor() {\r\n        super();\r\n\r\n        this.canvas = Page.Canvas.getCanvas();\r\n        this.context = this.canvas.getContext(\"2d\", { alpha: false });\r\n        this.cssPixel = window.devicePixelRatio ?? 1;\r\n    }\r\n\r\n    public resize(): void {\r\n        const actualWidth = Math.floor(this.cssPixel * this.canvas.clientWidth);\r\n        const actualHeight = Math.floor(this.cssPixel * this.canvas.clientHeight);\r\n\r\n        if (this.canvas.width !== actualWidth || this.canvas.height !== actualHeight) {\r\n            this.canvas.width = actualWidth;\r\n            this.canvas.height = actualHeight;\r\n        }\r\n    }\r\n\r\n    public initialize(infos: IPlotterInfo): void {\r\n        this.context.fillStyle = infos.backgroundColor;\r\n        this.context.strokeStyle = infos.lineColor;\r\n        this.context.lineWidth = infos.lineThickness * this.cssPixel;\r\n        this.context.lineJoin = \"round\";\r\n        this.context.lineCap = infos.roundLinecap ? \"round\" : \"butt\";\r\n        this.context.fillRect(0, 0, this.canvas.width, this.canvas.height);\r\n    }\r\n\r\n    // tslint:disable-next-line:no-empty\r\n    public finalize(): void { }\r\n\r\n    public set blur(value: number) {\r\n        if (value === 0) {\r\n            this.canvas.style.filter = \"\";\r\n        } else {\r\n            this.canvas.style.filter = `blur(${value}px)`;\r\n        }\r\n    }\r\n\r\n    protected get size(): ISize {\r\n        return {\r\n            width: Math.floor(this.canvas.width / this.cssPixel),\r\n            height: Math.floor(this.canvas.height / this.cssPixel),\r\n        };\r\n    }\r\n\r\n    protected startLineInternal(): void {\r\n        this.context.beginPath();\r\n    }\r\n\r\n    protected addFirstPointToLineInternal(rawX: number, rawY: number): void {\r\n        const x = rawX * this.cssPixel;\r\n        const y = rawY * this.cssPixel;\r\n        this.context.moveTo(x, y);\r\n    }\r\n\r\n    protected addPointToLineInternal(rawX: number, rawY: number): void {\r\n        const x = rawX * this.cssPixel;\r\n        const y = rawY * this.cssPixel;\r\n        this.context.lineTo(x, y);\r\n    }\r\n\r\n    protected endLineInternal(): void {\r\n        this.context.stroke();\r\n        this.context.closePath();\r\n    }\r\n}\r\n\r\nexport { PlotterCanvas2D }\r\n","import { PlotterBase, IPlotterInfo, ISize } from \"./plotter-base\";\r\n\r\nconst WIDTH = 1000;\r\nconst HEIGHT = 1000;\r\n\r\nclass PlotterSVG extends PlotterBase {\r\n    private stringParts: string[];\r\n    private hasBlur: boolean;\r\n\r\n    public constructor() {\r\n        super();\r\n    }\r\n\r\n    // tslint:disable-next-line:no-empty\r\n    public resize(): void {\r\n    }\r\n\r\n    public initialize(infos: IPlotterInfo): void {\r\n        this.hasBlur = infos.blur > 0;\r\n\r\n        this.stringParts = [];\r\n\r\n        this.stringParts.push(`<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\\n`);\r\n        this.stringParts.push(`<svg xmlns=\"http://www.w3.org/2000/svg\" version=\"1.1\" viewBox=\"0 0 ${WIDTH} ${HEIGHT}\">\\n`);\r\n\r\n        if (this.hasBlur) {\r\n            const blurEffectId = \"gaussianBlur\";\r\n\r\n            this.stringParts.push(`\\t<defs>\\n`);\r\n            this.stringParts.push(`\\t\\t<filter id=\"${blurEffectId}\" x=\"0\" y=\"0\">\\n`);\r\n            this.stringParts.push(`\\t\\t\\t<feGaussianBlur in=\"SourceGraphic\" stdDeviation=\"${infos.blur}\"/>\\n`);\r\n            this.stringParts.push(`\\t\\t</filter>\\n`);\r\n            this.stringParts.push(`\\t</defs>\\n`);\r\n            this.stringParts.push(`\\t<g filter=\"url(#${blurEffectId})\">\\n`);\r\n        }\r\n\r\n        this.stringParts.push(`\\t<rect fill=\"${infos.backgroundColor}\" stroke=\"none\" x=\"0\" y=\"0\" width=\"${WIDTH}\" height=\"${HEIGHT}\"/>\\n`);\r\n        const linecap = infos.roundLinecap ? ` stroke-linecap=\"round\"` : ``;\r\n        this.stringParts.push(`\\t<g fill=\"none\" stroke=\"${infos.lineColor}\" stroke-width=\"${infos.lineThickness}\" stroke-linejoin=\"round\"${linecap}>\\n`);\r\n    }\r\n\r\n    public finalize(): void {\r\n        if (this.hasBlur) {\r\n            this.stringParts.push(`\\t\\t</g>\\n`);\r\n        }\r\n\r\n        this.stringParts.push(`\\t</g>\\n`);\r\n        this.stringParts.push(`</svg>\\n`);\r\n    }\r\n\r\n    public endLineInternal(): void {\r\n        this.stringParts.push(`\"/>\\n`);\r\n    }\r\n\r\n    public export(): string {\r\n        const start = Date.now();\r\n        const result = this.stringParts.join(\"\");\r\n        console.log(`Concatenation took ${Date.now() - start} ms.`);\r\n        return result;\r\n    }\r\n\r\n    protected get size(): ISize {\r\n        return {\r\n            width: WIDTH,\r\n            height: HEIGHT,\r\n        };\r\n    }\r\n\r\n    protected startLineInternal(): void {\r\n        this.stringParts.push(`\\t\\t<path d=\"`);\r\n    }\r\n\r\n    protected addFirstPointToLineInternal(rawX: number, rawY: number): void {\r\n        const x = rawX.toFixed(1);\r\n        const y = rawY.toFixed(1);\r\n        this.stringParts.push(`M${x},${y}L`);\r\n    }\r\n\r\n    protected addPointToLineInternal(rawX: number, rawY: number): void {\r\n        const x = rawX.toFixed(1);\r\n        const y = rawY.toFixed(1);\r\n        this.stringParts.push(`${x},${y} `);\r\n    }\r\n}\r\n\r\nexport { PlotterSVG }\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(633);\n"],"names":["chooseLines","imageSizeInPlotter","linesSpacing","chosenType","Parameters","linesType","ELinesType","STRAIGHT","LinesStraightLines","SPIRAL","LinesSpiral","POLYGON","LinesPolygon","LinesSines","choosePattern","imageFitting","pattern","EPattern","WAVES","PatternWave","PatternDithering","downloadTextFile","content","filename","fileType","blob","Blob","type","window","navigator","msSaveBlob","URL","createObjectURL","linkElement","document","createElement","download","href","dataset","downloadurl","style","display","body","appendChild","click","removeChild","setTimeout","revokeObjectURL","image","this","hiddenCanvas","hiddenContext","getContext","willReadFrequently","sourceImage","_size","width","height","resize","wantedSize","wantedWidth","Math","min","wantedHeight","console","log","drawImage","fullPixelsArray","getImageData","data","valueArray","Uint8ClampedArray","i","length","r","g","b","sample","normalizedCoords","pixelCoords","x","y","floorPixelCoords","floor","fractPixelCoords","topLeft","getPixel","topRight","bottomLeft","bottomRight","top","interpolate","bottom","a","InputImage","distance","dX","dY","sqrt","rotate","p","angle","cosAngle","cos","sinAngle","sin","LinesBase","imageSize","_center","_suggestedImageSize","_linesSpacing","_nbSides","linesSides","diagonal","_maxSegments","ceil","walkOnLine","_lineId","step","callback","insideAngle","PI","dSideLength","tan","startSideLength","orientationAngle","orientationInRadians","cosOrientation","sinOrientation","startPoint","iSide","sideLength","tangentAngle","endPoint","normalAngle","normal","segmentLength","iSubstep","progression","rawPointX","rawPointY","_frequency","linesFrequency","_amplitude","linesAmplitude","max","_normal","_lines","push","computeLine","maxAbsLine","computeMaximumLinesNeeded","iAbsLine","iLine","line","lineId","computePoint","completion","wave","start","end","maxNbSteps","iStep","lineLength","tangent","center","_radiusGap","nbSemiCircles","_maxAngle","orientation","semiCircleId","radius","centerOffset","ELinesOrientation","linesOrientation","DIAGONAL","orientationInDegrees","VERTICAL","HORIZONTAL","xOutOfBounds","yOutOfBounds","computeBestImageSize","maxX","maxY","startAdjustment","endAdjustment","nbLines","plot","plotter","performance","now","fitImage","sourceImageAspectRatio","linesCount","zoomFactor","lines","Helpers","sizeInPlotter","suggestedImageSize","displayInfos","buildPlotterInfos","initialize","drawLine","finalize","inputImage","canvasPlotter","PlotterCanvas2D","plotOnCanvas","updateBlur","blur","onImageLoad","Page","Canvas","showLoader","addRedrawObserver","addBlurChangeObserver","addDownloadObserver","svgPlotter","PlotterSVG","svgString","export","addFileUploadObserver","defaultImage","Image","addEventListener","src","controlId","UPLOAD_INPUT_IMAGE","LINES_TYPE","LINES_COUNT","ORIENTATION","LINES_SIDES","LINES_AMPLITUDE","LINES_FREQUENCY","PATTERN","AMPLITUDE","FREQUENCY","ANGLE","WAVE_SQUARENESS","LINE_THICKNESS","INVERT_COLORS","BLUR","DOWNLOAD","redrawObservers","triggerRedraw","observer","Tabs","addObserver","Range","addLazyObserver","Checkbox","Observers","canvasResize","FileControl","addUploadObserver","filesList","FileReader","onload","result","readAsDataURL","getValues","getValue","isChecked","udpateControlsVisibility","Controls","setVisibility","SINES","lastAmplitude","lastFrequency","previousAmplitude","previousFrequency","newAmplitude","newFrequency","DITHERING","setValue","PatternBase","portionsSeeds","samplingFunction","chooseBestSamplingFunction","linesThickness","maxAmplitude","xFrequency","maxFrequency","baseMaxFrequency","samplesPerPortion","sampleFrequency","backgroundColor","invertColors","lineColor","lineThickness","roundLinecap","round","random","portionSeed","iSample","isDarkPortion","point","pixelToRelative","hasStartedALine","endLine","localDarkness","iQuantifiedColor","ditheringPatterns","ditheringPattern","iPortion","startLine","absolutePoint","relativeToAbsolute","addPointToLine","coords","waveFunction","computeWaveFunction","normalRotationFunction","computeNormalRotationFunction","samplesPerPixel","phase","localAmplitude","localHeight","rotatedNormal","localFrequency","lengthAdjustment","waveSquareness","amplitude","sharpness","sinPhase","sign","pow","abs","ANGLE_THRESHOLD","_hasStartedALine","startLineInternal","lastDrawnPoint","potentialNextPoint","newPoint","addFirstPointToLineInternal","PlotterBase","computeAngle","addPointToLineInternal","endLineInternal","imageAspectRatio","plotterSize","size","displayAspectRatio","offSetX","offSetY","minSide","baseMinSide","relativeCoords","pixelCoordinates","p1","p2","p3","angle1","atan2","angle2","diffAngle","canvas","getCanvas","context","alpha","cssPixel","devicePixelRatio","actualWidth","clientWidth","actualHeight","clientHeight","infos","fillStyle","strokeStyle","lineWidth","lineJoin","lineCap","fillRect","value","filter","beginPath","rawX","rawY","moveTo","lineTo","stroke","closePath","WIDTH","HEIGHT","hasBlur","stringParts","blurEffectId","linecap","Date","join","toFixed","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","call"],"sourceRoot":""}